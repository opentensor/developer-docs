
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>bittensor.core.dendrite &#8212; Bittensor SDK Docs  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bittensor-custom.css?v=c1dfe055" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/bittensor/core/dendrite';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.svg" class="logo__image only-light" alt="Bittensor SDK Docs  documentation - Home"/>
    <img src="../../../_static/logo-dark-mode.svg" class="logo__image only-dark pst-js-only" alt="Bittensor SDK Docs  documentation - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/bittensor/index.html">bittensor</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/bittensor/core/index.html">bittensor.core</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/async_subtensor/index.html">bittensor.core.async_subtensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/axon/index.html">bittensor.core.axon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/chain_data/index.html">bittensor.core.chain_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/config/index.html">bittensor.core.config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/dendrite/index.html">bittensor.core.dendrite</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/errors/index.html">bittensor.core.errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/extrinsics/index.html">bittensor.core.extrinsics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/metagraph/index.html">bittensor.core.metagraph</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/settings/index.html">bittensor.core.settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/stream/index.html">bittensor.core.stream</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/subtensor/index.html">bittensor.core.subtensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/synapse/index.html">bittensor.core.synapse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/tensor/index.html">bittensor.core.tensor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/threadpool/index.html">bittensor.core.threadpool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/core/types/index.html">bittensor.core.types</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/bittensor/utils/index.html">bittensor.utils</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/axon_utils/index.html">bittensor.utils.axon_utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/balance/index.html">bittensor.utils.balance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/btlogging/index.html">bittensor.utils.btlogging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/delegates_details/index.html">bittensor.utils.delegates_details</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/deprecated/index.html">bittensor.utils.deprecated</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/formatting/index.html">bittensor.utils.formatting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/mock/index.html">bittensor.utils.mock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/networking/index.html">bittensor.utils.networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/registration/index.html">bittensor.utils.registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/subnets/index.html">bittensor.utils.subnets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/substrate_utils/index.html">bittensor.utils.substrate_utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/version/index.html">bittensor.utils.version</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/bittensor/utils/weight_utils/index.html">bittensor.utils.weight_utils</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/opentensor/btcli" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/opentensor/btcli/issues/new?title=Issue%20on%20page%20%2F_modules/bittensor/core/dendrite.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for bittensor.core.dendrite</h1><div class="highlight"><pre>
<span></span><span class="c1"># The MIT License (MIT)</span>
<span class="c1"># Copyright © 2024 Opentensor Foundation</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated</span>
<span class="c1"># documentation files (the “Software”), to deal in the Software without restriction, including without limitation</span>
<span class="c1"># the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,</span>
<span class="c1"># and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included in all copies or substantial portions of</span>
<span class="c1"># the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO</span>
<span class="c1"># THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</span>
<span class="c1"># THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION</span>
<span class="c1"># OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="c1"># DEALINGS IN THE SOFTWARE.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">AsyncGenerator</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Type</span>

<span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">from</span> <span class="nn">bittensor_wallet</span> <span class="kn">import</span> <span class="n">Keypair</span><span class="p">,</span> <span class="n">Wallet</span>

<span class="kn">from</span> <span class="nn">bittensor.core.axon</span> <span class="kn">import</span> <span class="n">Axon</span>
<span class="kn">from</span> <span class="nn">bittensor.core.chain_data</span> <span class="kn">import</span> <span class="n">AxonInfo</span>
<span class="kn">from</span> <span class="nn">bittensor.core.settings</span> <span class="kn">import</span> <span class="n">version_as_int</span>
<span class="kn">from</span> <span class="nn">bittensor.core.stream</span> <span class="kn">import</span> <span class="n">StreamingSynapse</span>
<span class="kn">from</span> <span class="nn">bittensor.core.synapse</span> <span class="kn">import</span> <span class="n">Synapse</span><span class="p">,</span> <span class="n">TerminalInfo</span>
<span class="kn">from</span> <span class="nn">bittensor.utils</span> <span class="kn">import</span> <span class="n">networking</span>
<span class="kn">from</span> <span class="nn">bittensor.utils.btlogging</span> <span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">bittensor.utils.registration</span> <span class="kn">import</span> <span class="n">torch</span><span class="p">,</span> <span class="n">use_torch</span>

<span class="n">DENDRITE_ERROR_MAPPING</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">Exception</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientConnectorError</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;503&quot;</span><span class="p">,</span> <span class="s2">&quot;Service unavailable&quot;</span><span class="p">),</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;408&quot;</span><span class="p">,</span> <span class="s2">&quot;Request timeout&quot;</span><span class="p">),</span>
    <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientResponseError</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Client response error&quot;</span><span class="p">),</span>
    <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientPayloadError</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;400&quot;</span><span class="p">,</span> <span class="s2">&quot;Payload error&quot;</span><span class="p">),</span>
    <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientError</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;500&quot;</span><span class="p">,</span> <span class="s2">&quot;Client error&quot;</span><span class="p">),</span>
    <span class="n">aiohttp</span><span class="o">.</span><span class="n">ServerTimeoutError</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;504&quot;</span><span class="p">,</span> <span class="s2">&quot;Server timeout error&quot;</span><span class="p">),</span>
    <span class="n">aiohttp</span><span class="o">.</span><span class="n">ServerDisconnectedError</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;503&quot;</span><span class="p">,</span> <span class="s2">&quot;Service disconnected&quot;</span><span class="p">),</span>
    <span class="n">aiohttp</span><span class="o">.</span><span class="n">ServerConnectionError</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;503&quot;</span><span class="p">,</span> <span class="s2">&quot;Service connection error&quot;</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">DENDRITE_DEFAULT_ERROR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;422&quot;</span><span class="p">,</span> <span class="s2">&quot;Failed to parse response&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="DendriteMixin">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin">[docs]</a>
<span class="k">class</span> <span class="nc">DendriteMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Dendrite class represents the abstracted implementation of a network client module.</span>

<span class="sd">    In the brain analogy, dendrites receive signals</span>
<span class="sd">    from other neurons (in this case, network servers or axons), and the Dendrite class here is designed</span>
<span class="sd">    to send requests to those endpoint to receive inputs.</span>

<span class="sd">    This class includes a wallet or keypair used for signing messages, and methods for making</span>
<span class="sd">    HTTP requests to the network servers. It also provides functionalities such as logging</span>
<span class="sd">    network requests and processing server responses.</span>

<span class="sd">    Args:</span>
<span class="sd">        keypair (Option[Union[bittensor_wallet.Wallet, substrateinterface.Keypair]]): The wallet or keypair used for signing messages.</span>
<span class="sd">        external_ip (str): The external IP address of the local system.</span>
<span class="sd">        synapse_history (list): A list of Synapse objects representing the historical responses.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __str__(): Returns a string representation of the Dendrite object.</span>
<span class="sd">        __repr__(): Returns a string representation of the Dendrite object, acting as a fallback for __str__().</span>
<span class="sd">        query(self, *args, **kwargs) -&gt; Union[Synapse, list[Synapse]]: Makes synchronous requests to one or multiple target Axons and returns responses.</span>
<span class="sd">        forward(self, axons, synapse=Synapse(), timeout=12, deserialize=True, run_async=True, streaming=False) -&gt; Synapse: Asynchronously sends requests to one or multiple Axons and collates their responses.</span>
<span class="sd">        call(self, target_axon, synapse=Synapse(), timeout=12.0, deserialize=True) -&gt; Synapse: Asynchronously sends a request to a specified Axon and processes the response.</span>
<span class="sd">        call_stream(self, target_axon, synapse=Synapse(), timeout=12.0, deserialize=True) -&gt; AsyncGenerator[Synapse, None]: Sends a request to a specified Axon and yields an AsyncGenerator that contains streaming response chunks before finally yielding the filled Synapse as the final element.</span>
<span class="sd">        preprocess_synapse_for_request(self, target_axon_info, synapse, timeout=12.0) -&gt; Synapse: Preprocesses the synapse for making a request, including building headers and signing.</span>
<span class="sd">        process_server_response(self, server_response, json_response, local_synapse): Processes the server response, updates the local synapse state, and merges headers.</span>
<span class="sd">        close_session(self): Synchronously closes the internal aiohttp client session.</span>
<span class="sd">        aclose_session(self): Asynchronously closes the internal aiohttp client session.</span>

<span class="sd">    NOTE:</span>
<span class="sd">        When working with async `aiohttp &lt;https://github.com/aio-libs/aiohttp&gt;`_ client sessions, it is recommended to use a context manager.</span>

<span class="sd">    Example with a context manager::</span>

<span class="sd">        async with dendrite(wallet = bittensor_wallet.Wallet()) as d:</span>
<span class="sd">            print(d)</span>
<span class="sd">            d( &lt;axon&gt; ) # ping axon</span>
<span class="sd">            d( [&lt;axons&gt;] ) # ping multiple</span>
<span class="sd">            d( Axon(), Synapse )</span>

<span class="sd">    However, you are able to safely call :func:`dendrite.query()` without a context manager in a synchronous setting.</span>

<span class="sd">    Example without a context manager::</span>

<span class="sd">        d = dendrite(wallet = bittensor_wallet.Wallet() )</span>
<span class="sd">        print(d)</span>
<span class="sd">        d( &lt;axon&gt; ) # ping axon</span>
<span class="sd">        d( [&lt;axons&gt;] ) # ping multiple</span>
<span class="sd">        d( bittensor.core.axon.Axon, bittensor.core.synapse.Synapse )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wallet</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Wallet&quot;</span><span class="p">,</span> <span class="s2">&quot;Keypair&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Dendrite object, setting up essential properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            wallet (Optional[Union[bittensor_wallet.Wallet, substrateinterface.Keypair]]): The user&#39;s wallet or keypair used for signing messages. Defaults to ``None``, in which case a new :func:`bittensor_wallet.Wallet().hotkey` is generated and used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize the parent class</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DendriteMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Unique identifier for the instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>

        <span class="c1"># Get the external IP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_ip</span> <span class="o">=</span> <span class="n">networking</span><span class="o">.</span><span class="n">get_external_ip</span><span class="p">()</span>

        <span class="c1"># If a wallet or keypair is provided, use its hotkey. If not, generate a new one.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keypair</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">wallet</span><span class="o">.</span><span class="n">hotkey</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wallet</span><span class="p">,</span> <span class="n">Wallet</span><span class="p">)</span> <span class="k">else</span> <span class="n">wallet</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="n">Wallet</span><span class="p">()</span><span class="o">.</span><span class="n">hotkey</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">synapse_history</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An asynchronous property that provides access to the internal `aiohttp &lt;https://github.com/aio-libs/aiohttp&gt;`_ client session.</span>

<span class="sd">        This property ensures the management of HTTP connections in an efficient way. It lazily</span>
<span class="sd">        initializes the `aiohttp.ClientSession &lt;https://docs.aiohttp.org/en/stable/client_reference.html#aiohttp.ClientSession&gt;`_ on its first use. The session is then reused for subsequent</span>
<span class="sd">        HTTP requests, offering performance benefits by reusing underlying connections.</span>

<span class="sd">        This is used internally by the dendrite when querying axons, and should not be used directly</span>
<span class="sd">        unless absolutely necessary for your application.</span>

<span class="sd">        Returns:</span>
<span class="sd">            aiohttp.ClientSession: The active `aiohttp &lt;https://github.com/aio-libs/aiohttp&gt;`_ client session instance. If no session exists, a</span>
<span class="sd">            new one is created and returned. This session is used for asynchronous HTTP requests within</span>
<span class="sd">            the dendrite, adhering to the async nature of the network interactions in the Bittensor framework.</span>

<span class="sd">        Example usage::</span>

<span class="sd">            import bittensor                                # Import bittensor</span>
<span class="sd">            wallet = bittensor.Wallet( ... )                # Initialize a wallet</span>
<span class="sd">            dendrite = bittensor.Dendrite(wallet=wallet)   # Initialize a dendrite instance with the wallet</span>

<span class="sd">            async with (await dendrite.session).post(       # Use the session to make an HTTP POST request</span>
<span class="sd">                url,                                        # URL to send the request to</span>
<span class="sd">                headers={...},                              # Headers dict to be sent with the request</span>
<span class="sd">                json={...},                                 # JSON body data to be sent with the request</span>
<span class="sd">                timeout=10,                                 # Timeout duration in seconds</span>
<span class="sd">            ) as response:</span>
<span class="sd">                json_response = await response.json()       # Extract the JSON response from the server</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>

<div class="viewcode-block" id="DendriteMixin.close_session">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.close_session">[docs]</a>
    <span class="k">def</span> <span class="nf">close_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the internal `aiohttp &lt;https://github.com/aio-libs/aiohttp&gt;`_ client session synchronously.</span>

<span class="sd">        This method ensures the proper closure and cleanup of the aiohttp client session, releasing any</span>
<span class="sd">        resources like open connections and internal buffers. It is crucial for preventing resource leakage</span>
<span class="sd">        and should be called when the dendrite instance is no longer in use, especially in synchronous contexts.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method utilizes asyncio&#39;s event loop to close the session asynchronously from a synchronous context. It is advisable to use this method only when asynchronous context management is not feasible.</span>

<span class="sd">        Usage:</span>
<span class="sd">            When finished with dendrite in a synchronous context</span>
<span class="sd">            :func:`dendrite_instance.close_session()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">close</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="DendriteMixin.aclose_session">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.aclose_session">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">aclose_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously closes the internal `aiohttp &lt;https://github.com/aio-libs/aiohttp&gt;`_ client session.</span>

<span class="sd">        This method is the asynchronous counterpart to the :func:`close_session` method. It should be used in</span>
<span class="sd">        asynchronous contexts to ensure that the aiohttp client session is closed properly. The method</span>
<span class="sd">        releases resources associated with the session, such as open connections and internal buffers,</span>
<span class="sd">        which is essential for resource management in asynchronous applications.</span>

<span class="sd">        Example:</span>
<span class="sd">            Usage::</span>
<span class="sd">                When finished with dendrite in an asynchronous context</span>
<span class="sd">                await :func:`dendrite_instance.aclose_session()`.</span>

<span class="sd">        Example:</span>
<span class="sd">            Usage::</span>
<span class="sd">                async with dendrite_instance:</span>
<span class="sd">                    # Operations using dendrite</span>
<span class="sd">                    pass</span>
<span class="sd">                # The session will be closed automatically after the above block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">def</span> <span class="nf">_get_endpoint_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_axon</span><span class="p">,</span> <span class="n">request_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs the endpoint URL for a network request to a target axon.</span>

<span class="sd">        This internal method generates the full HTTP URL for sending a request to the specified axon. The</span>
<span class="sd">        URL includes the IP address and port of the target axon, along with the specific request name. It</span>
<span class="sd">        differentiates between requests to the local system (using &#39;0.0.0.0&#39;) and external systems.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_axon: The target axon object containing IP and port information.</span>
<span class="sd">            request_name: The specific name of the request being made.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A string representing the complete HTTP URL for the request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;0.0.0.0:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target_axon</span><span class="o">.</span><span class="n">port</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">target_axon</span><span class="o">.</span><span class="n">ip</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_ip</span><span class="p">)</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_axon</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target_axon</span><span class="o">.</span><span class="n">port</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">request_name</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="DendriteMixin.log_exception">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.log_exception">[docs]</a>
    <span class="k">def</span> <span class="nf">log_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs an exception with a unique identifier.</span>

<span class="sd">        This method generates a unique UUID for the error, extracts the error type,</span>
<span class="sd">        and logs the error message using Bittensor&#39;s logging system.</span>

<span class="sd">        Args:</span>
<span class="sd">            exception (Exception): The exception object to be logged.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">error_type</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="p">(</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientConnectorError</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">)):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_type</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">error_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error_type</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">error_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">exception</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DendriteMixin.process_error_message">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.process_error_message">[docs]</a>
    <span class="k">def</span> <span class="nf">process_error_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">synapse</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="s2">&quot;StreamingSynapse&quot;</span><span class="p">],</span>
        <span class="n">request_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="s2">&quot;StreamingSynapse&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles exceptions that occur during network requests, updating the synapse with appropriate status codes and messages.</span>

<span class="sd">        This method interprets different types of exceptions and sets the corresponding status code and</span>
<span class="sd">        message in the synapse object. It covers common network errors such as connection issues and timeouts.</span>

<span class="sd">        Args:</span>
<span class="sd">            synapse (bittensor.core.synapse.Synapse): The synapse object associated with the request.</span>
<span class="sd">            request_name (str): The name of the request during which the exception occurred.</span>
<span class="sd">            exception (Exception): The exception object caught during the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Synapse (bittensor.core.synapse.Synapse): The updated synapse object with the error status code and message.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method updates the synapse object in-place.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_exception</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>

        <span class="n">error_info</span> <span class="o">=</span> <span class="n">DENDRITE_ERROR_MAPPING</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exception</span><span class="p">),</span> <span class="n">DENDRITE_DEFAULT_ERROR</span><span class="p">)</span>
        <span class="n">status_code</span><span class="p">,</span> <span class="n">status_message</span> <span class="o">=</span> <span class="n">error_info</span>

        <span class="k">if</span> <span class="n">status_code</span><span class="p">:</span>
            <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status_code</span>  <span class="c1"># type: ignore</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientResponseError</span><span class="p">):</span>
            <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_message</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientConnectorError</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_message</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">request_name</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># type: ignore</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">status_message</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds&quot;</span>

        <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">message</span>  <span class="c1"># type: ignore</span>

        <span class="k">return</span> <span class="n">synapse</span></div>


    <span class="k">def</span> <span class="nf">_log_outgoing_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synapse</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs information about outgoing requests for debugging purposes.</span>

<span class="sd">        This internal method logs key details about each outgoing request, including the size of the</span>
<span class="sd">        request, the name of the synapse, the axon&#39;s details, and a success indicator. This information</span>
<span class="sd">        is crucial for monitoring and debugging network activity within the Bittensor network.</span>

<span class="sd">        To turn on debug messages, set the environment variable BITTENSOR_DEBUG to ``1``, or call the bittensor debug method like so::</span>

<span class="sd">        Example::</span>

<span class="sd">            import bittensor</span>
<span class="sd">            bittensor.debug()</span>

<span class="sd">        Args:</span>
<span class="sd">            synapse (bittensor.core.synapse.Synapse): The synapse object representing the request being sent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">synapse</span><span class="o">.</span><span class="n">axon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;dendrite | --&gt; | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">get_total_size</span><span class="p">()</span><span class="si">}</span><span class="s2"> B | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">hotkey</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">port</span><span class="p">)</span><span class="si">}</span><span class="s2"> | 0 | Success&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_incoming_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synapse</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs information about incoming responses for debugging and monitoring.</span>

<span class="sd">        Similar to :func:`_log_outgoing_request`, this method logs essential details of the incoming responses,</span>
<span class="sd">        including the size of the response, synapse name, axon details, status code, and status message.</span>
<span class="sd">        This logging is vital for troubleshooting and understanding the network interactions in Bittensor.</span>

<span class="sd">        Args:</span>
<span class="sd">            synapse (bittensor.core.synapse.Synapse): The synapse object representing the received response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">synapse</span><span class="o">.</span><span class="n">axon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;dendrite | &lt;-- | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">get_total_size</span><span class="p">()</span><span class="si">}</span><span class="s2"> B | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">hotkey</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">port</span><span class="p">)</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">status_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="DendriteMixin.query">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.query">[docs]</a>
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AsyncGenerator[Any, Any]&quot;</span><span class="p">,</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="s2">&quot;StreamingSynapse&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a synchronous request to multiple target Axons and returns the server responses.</span>

<span class="sd">        Cleanup is automatically handled and sessions are closed upon completed requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            axons (Union[list[Union[bittensor.core.chain_data.axon_info.AxonInfo, &#39;bittensor.core.axon.Axon&#39;]], Union[&#39;bittensor.core.chain_data.axon_info.AxonInfo&#39;, &#39;bittensor.core.axon.Axon&#39;]]): The list of target Axon information.</span>
<span class="sd">            synapse (Optional[bittensor.core.synapse.Synapse]): The Synapse object. Defaults to :func:`Synapse()`.</span>
<span class="sd">            timeout (Optional[float]): The request timeout duration in seconds. Defaults to ``12.0`` seconds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[bittensor.core.synapse.Synapse, list[bittensor.core.synapse.Synapse]]: If a single target axon is provided, returns the response from that axon. If multiple target axons are provided, returns a list of responses from all target axons.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">new_loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">set_event_loop</span><span class="p">(</span><span class="n">new_loop</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">new_loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="n">new_loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="DendriteMixin.forward">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.forward">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">axons</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AxonInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Axon&quot;</span><span class="p">]],</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AxonInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Axon&quot;</span><span class="p">]],</span>
        <span class="n">synapse</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span> <span class="o">=</span> <span class="n">Synapse</span><span class="p">(),</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">deserialize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">run_async</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">streaming</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AsyncGenerator[Any, Any]&quot;</span><span class="p">,</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="s2">&quot;StreamingSynapse&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously sends requests to one or multiple Axons and collates their responses.</span>

<span class="sd">        This function acts as a bridge for sending multiple requests concurrently or sequentially</span>
<span class="sd">        based on the provided parameters. It checks the type of the target Axons, preprocesses</span>
<span class="sd">        the requests, and then sends them off. After getting the responses, it processes and</span>
<span class="sd">        collates them into a unified format.</span>

<span class="sd">        When querying an Axon that sends a single response, this function returns a Synapse object</span>
<span class="sd">        containing the response data. If multiple Axons are queried, a list of Synapse objects is</span>
<span class="sd">        returned, each containing the response from the corresponding Axon.</span>

<span class="sd">        For example::</span>

<span class="sd">            ...</span>
<span class="sd">            import bittensor</span>
<span class="sd">            wallet = bittensor.Wallet()                     # Initialize a wallet</span>
<span class="sd">            synapse = bittensor.Synapse(...)                # Create a synapse object that contains query data</span>
<span class="sd">            dendrite = bittensor.Dendrite(wallet = wallet)  # Initialize a dendrite instance</span>
<span class="sd">            netuid = ...                                    # Provide subnet ID</span>
<span class="sd">            metagraph = bittensor.Metagraph(netuid)         # Initialize a metagraph instance</span>
<span class="sd">            axons = metagraph.axons                         # Create a list of axons to query</span>
<span class="sd">            responses = await dendrite(axons, synapse)      # Send the query to all axons and await the responses</span>

<span class="sd">        When querying an Axon that sends back data in chunks using the Dendrite, this function</span>
<span class="sd">        returns an AsyncGenerator that yields each chunk as it is received. The generator can be</span>
<span class="sd">        iterated over to process each chunk individually.</span>

<span class="sd">        For example::</span>

<span class="sd">            ...</span>
<span class="sd">            dendrite = bittensor.Dendrite(wallet = wallet)</span>
<span class="sd">            async for chunk in dendrite.forward(axons, synapse, timeout, deserialize, run_async, streaming):</span>
<span class="sd">                # Process each chunk here</span>
<span class="sd">                print(chunk)</span>

<span class="sd">        Args:</span>
<span class="sd">            axons (Union[list[Union[bittensor.core.chain_data.axon_info.AxonInfo, bittensor.core.axon.Axon]], Union[bittensor.core.chain_data.axon_info.AxonInfo, bittensor.core.axon.Axon]]): The target Axons to send requests to. Can be a single Axon or a list of Axons.</span>
<span class="sd">            synapse (bittensor.core.synapse.Synapse): The Synapse object encapsulating the data. Defaults to a new :func:`Synapse` instance.</span>
<span class="sd">            timeout (float): Maximum duration to wait for a response from an Axon in seconds. Defaults to ``12.0``.</span>
<span class="sd">            deserialize (bool): Determines if the received response should be deserialized. Defaults to ``True``.</span>
<span class="sd">            run_async (bool): If ``True``, sends requests concurrently. Otherwise, sends requests sequentially. Defaults to ``True``.</span>
<span class="sd">            streaming (bool): Indicates if the response is expected to be in streaming format. Defaults to ``False``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[AsyncGenerator, bittensor.core.synapse.Synapse, list[bittensor.core.synapse.Synapse]]: If a single `Axon` is targeted, returns its response.</span>
<span class="sd">            If multiple Axons are targeted, returns a list of their responses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_list</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># If a single axon is provided, wrap it in a list for uniform processing</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axons</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">is_list</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">axons</span> <span class="o">=</span> <span class="p">[</span><span class="n">axons</span><span class="p">]</span>

        <span class="c1"># Check if synapse is an instance of the StreamingSynapse class or if streaming flag is set.</span>
        <span class="n">is_streaming_subclass</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">synapse</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">StreamingSynapse</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">streaming</span> <span class="o">!=</span> <span class="n">is_streaming_subclass</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Argument streaming is </span><span class="si">{</span><span class="n">streaming</span><span class="si">}</span><span class="s2"> while issubclass(synapse, StreamingSynapse) is </span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. This may cause unexpected behavior.&quot;</span>
            <span class="p">)</span>
        <span class="n">streaming</span> <span class="o">=</span> <span class="n">is_streaming_subclass</span> <span class="ow">or</span> <span class="n">streaming</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">query_all_axons</span><span class="p">(</span>
            <span class="n">is_stream</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AsyncGenerator[Any, Any]&quot;</span><span class="p">,</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="s2">&quot;StreamingSynapse&quot;</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Handles the processing of requests to all targeted axons, accommodating both streaming and non-streaming responses.</span>

<span class="sd">            This function manages the concurrent or sequential dispatch of requests to a list of axons.</span>
<span class="sd">            It utilizes the ``is_stream`` parameter to determine the mode of response handling (streaming</span>
<span class="sd">            or non-streaming). For each axon, it calls ``single_axon_response`` and aggregates the responses.</span>

<span class="sd">            Args:</span>
<span class="sd">                is_stream (bool): Flag indicating whether the axon responses are expected to be streamed.</span>
<span class="sd">                If ``True``, responses are handled in streaming mode.</span>

<span class="sd">            Returns:</span>
<span class="sd">                list[Union[AsyncGenerator, bittensor.core.synapse.Synapse, bittensor.core.stream.StreamingSynapse]]: A list containing the responses from each axon. The type of each response depends on the streaming mode and the type of synapse used.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">async</span> <span class="k">def</span> <span class="nf">single_axon_response</span><span class="p">(</span>
                <span class="n">target_axon</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AxonInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Axon&quot;</span><span class="p">],</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AsyncGenerator[Any, Any]&quot;</span><span class="p">,</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span> <span class="s2">&quot;StreamingSynapse&quot;</span><span class="p">]:</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Manages the request and response process for a single axon, supporting both streaming and non-streaming modes.</span>

<span class="sd">                This function is responsible for initiating a request to a single axon. Depending on the ``is_stream`` flag, it either uses ``call_stream`` for streaming responses or ``call`` for standard responses. The function handles the response processing, catering to the specifics of streaming or non-streaming data.</span>

<span class="sd">                Args:</span>
<span class="sd">                    target_axon (Union[bittensor.core.chain_data.axon_info.AxonInfo, bittensor.core.axon.Axon): The target axon object to which the request is to be sent. This object contains the necessary information like IP address and port to formulate the request.</span>

<span class="sd">                Returns:</span>
<span class="sd">                    Union[AsyncGenerator, bittensor.core.synapse.Synapse, bittensor.core.stream.StreamingSynapse]: The response from the targeted axon. In streaming mode, an AsyncGenerator is returned, yielding data chunks. In non-streaming mode, a Synapse or StreamingSynapse object is returned containing the response.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">is_stream</span><span class="p">:</span>
                    <span class="c1"># If in streaming mode, return the async_generator</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_stream</span><span class="p">(</span>
                        <span class="n">target_axon</span><span class="o">=</span><span class="n">target_axon</span><span class="p">,</span>
                        <span class="n">synapse</span><span class="o">=</span><span class="n">synapse</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(),</span>  <span class="c1"># type: ignore</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                        <span class="n">deserialize</span><span class="o">=</span><span class="n">deserialize</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If not in streaming mode, simply call the axon and get the response.</span>
                    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
                        <span class="n">target_axon</span><span class="o">=</span><span class="n">target_axon</span><span class="p">,</span>
                        <span class="n">synapse</span><span class="o">=</span><span class="n">synapse</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(),</span>  <span class="c1"># type: ignore</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                        <span class="n">deserialize</span><span class="o">=</span><span class="n">deserialize</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># If run_async flag is False, get responses one by one.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">run_async</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="k">await</span> <span class="n">single_axon_response</span><span class="p">(</span><span class="n">target_axon</span><span class="p">)</span> <span class="k">for</span> <span class="n">target_axon</span> <span class="ow">in</span> <span class="n">axons</span>
                <span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="c1"># If run_async flag is True, get responses concurrently using asyncio.gather().</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span><span class="n">single_axon_response</span><span class="p">(</span><span class="n">target_axon</span><span class="p">)</span> <span class="k">for</span> <span class="n">target_axon</span> <span class="ow">in</span> <span class="n">axons</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Get responses for all axons.</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">query_all_axons</span><span class="p">(</span><span class="n">streaming</span><span class="p">)</span>
        <span class="c1"># Return the single response if only one axon was targeted, else return all responses</span>
        <span class="k">return</span> <span class="n">responses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_list</span> <span class="k">else</span> <span class="n">responses</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="DendriteMixin.call">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.call">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_axon</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AxonInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Axon&quot;</span><span class="p">],</span>
        <span class="n">synapse</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span> <span class="o">=</span> <span class="n">Synapse</span><span class="p">(),</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">,</span>
        <span class="n">deserialize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously sends a request to a specified Axon and processes the response.</span>

<span class="sd">        This function establishes a connection with a specified Axon, sends the encapsulated data through the Synapse object, waits for a response, processes it, and then returns the updated Synapse object.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_axon (Union[bittensor.core.chain_data.axon_info.AxonInfo, bittensor.core.axon.Axon]): The target Axon to send the request to.</span>
<span class="sd">            synapse (bittensor.core.synapse.Synapse): The Synapse object encapsulating the data. Defaults to a new :func:`Synapse` instance.</span>
<span class="sd">            timeout (float): Maximum duration to wait for a response from the Axon in seconds. Defaults to ``12.0``.</span>
<span class="sd">            deserialize (bool): Determines if the received response should be deserialized. Defaults to ``True``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bittensor.core.synapse.Synapse: The Synapse object, updated with the response data from the Axon.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Record start time</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">target_axon</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">target_axon</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_axon</span><span class="p">,</span> <span class="n">Axon</span><span class="p">)</span> <span class="k">else</span> <span class="n">target_axon</span>
        <span class="p">)</span>

        <span class="c1"># Build request endpoint from the synapse class</span>
        <span class="n">request_name</span> <span class="o">=</span> <span class="n">synapse</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_endpoint_url</span><span class="p">(</span><span class="n">target_axon</span><span class="p">,</span> <span class="n">request_name</span><span class="o">=</span><span class="n">request_name</span><span class="p">)</span>

        <span class="c1"># Preprocess synapse for making a request</span>
        <span class="n">synapse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_synapse_for_request</span><span class="p">(</span><span class="n">target_axon</span><span class="p">,</span> <span class="n">synapse</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Log outgoing request</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_outgoing_request</span><span class="p">(</span><span class="n">synapse</span><span class="p">)</span>

            <span class="c1"># Make the HTTP POST request</span>
            <span class="k">async</span> <span class="k">with</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">synapse</span><span class="o">.</span><span class="n">to_headers</span><span class="p">(),</span>
                <span class="n">json</span><span class="o">=</span><span class="n">synapse</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">timeout</span><span class="p">),</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="c1"># Extract the JSON response from the server</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="c1"># Process the server response and fill synapse</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_server_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">json_response</span><span class="p">,</span> <span class="n">synapse</span><span class="p">)</span>

            <span class="c1"># Set process time and log the response</span>
            <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">process_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">synapse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_error_message</span><span class="p">(</span><span class="n">synapse</span><span class="p">,</span> <span class="n">request_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_incoming_response</span><span class="p">(</span><span class="n">synapse</span><span class="p">)</span>

            <span class="c1"># Log synapse event history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">synapse_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Synapse</span><span class="o">.</span><span class="n">from_headers</span><span class="p">(</span><span class="n">synapse</span><span class="o">.</span><span class="n">to_headers</span><span class="p">()))</span>

            <span class="c1"># Return the updated synapse object after deserializing if requested</span>
            <span class="k">return</span> <span class="n">synapse</span><span class="o">.</span><span class="n">deserialize</span><span class="p">()</span> <span class="k">if</span> <span class="n">deserialize</span> <span class="k">else</span> <span class="n">synapse</span></div>


<div class="viewcode-block" id="DendriteMixin.call_stream">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.call_stream">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">call_stream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_axon</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;AxonInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Axon&quot;</span><span class="p">],</span>
        <span class="n">synapse</span><span class="p">:</span> <span class="s2">&quot;StreamingSynapse&quot;</span> <span class="o">=</span> <span class="n">Synapse</span><span class="p">(),</span>  <span class="c1"># type: ignore</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">,</span>
        <span class="n">deserialize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;AsyncGenerator[Any, Any]&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a request to a specified Axon and yields streaming responses.</span>

<span class="sd">        Similar to ``call``, but designed for scenarios where the Axon sends back data in</span>
<span class="sd">        multiple chunks or streams. The function yields each chunk as it is received. This is</span>
<span class="sd">        useful for processing large responses piece by piece without waiting for the entire</span>
<span class="sd">        data to be transmitted.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_axon (Union[bittensor.core.chain_data.axon_info.AxonInfo, bittensor.core.axon.Axon]): The target Axon to send the request to.</span>
<span class="sd">            synapse (bittensor.core.synapse.Synapse): The Synapse object encapsulating the data. Defaults to a new :func:`Synapse` instance.</span>
<span class="sd">            timeout (float): Maximum duration to wait for a response (or a chunk of the response) from the Axon in seconds. Defaults to ``12.0``.</span>
<span class="sd">            deserialize (bool): Determines if each received chunk should be deserialized. Defaults to ``True``.</span>

<span class="sd">        Yields:</span>
<span class="sd">            object: Each yielded object contains a chunk of the arbitrary response data from the Axon.</span>
<span class="sd">            bittensor.core.synapse.Synapse: After the AsyncGenerator has been exhausted, yields the final filled Synapse.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Record start time</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">target_axon</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">target_axon</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_axon</span><span class="p">,</span> <span class="n">Axon</span><span class="p">)</span> <span class="k">else</span> <span class="n">target_axon</span>
        <span class="p">)</span>

        <span class="c1"># Build request endpoint from the synapse class</span>
        <span class="n">request_name</span> <span class="o">=</span> <span class="n">synapse</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;0.0.0.0:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target_axon</span><span class="o">.</span><span class="n">port</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">target_axon</span><span class="o">.</span><span class="n">ip</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">external_ip</span><span class="p">)</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_axon</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target_axon</span><span class="o">.</span><span class="n">port</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">request_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Preprocess synapse for making a request</span>
        <span class="n">synapse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_synapse_for_request</span><span class="p">(</span><span class="n">target_axon</span><span class="p">,</span> <span class="n">synapse</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Log outgoing request</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_outgoing_request</span><span class="p">(</span><span class="n">synapse</span><span class="p">)</span>

            <span class="c1"># Make the HTTP POST request</span>
            <span class="k">async</span> <span class="k">with</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">synapse</span><span class="o">.</span><span class="n">to_headers</span><span class="p">(),</span>
                <span class="n">json</span><span class="o">=</span><span class="n">synapse</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientTimeout</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">timeout</span><span class="p">),</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="c1"># Use synapse subclass&#39; process_streaming_response method to yield the response chunks</span>
                <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">synapse</span><span class="o">.</span><span class="n">process_streaming_response</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
                    <span class="k">yield</span> <span class="n">chunk</span>  <span class="c1"># Yield each chunk as it&#39;s processed</span>
                <span class="n">json_response</span> <span class="o">=</span> <span class="n">synapse</span><span class="o">.</span><span class="n">extract_response_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

                <span class="c1"># Process the server response</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_server_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">json_response</span><span class="p">,</span> <span class="n">synapse</span><span class="p">)</span>

            <span class="c1"># Set process time and log the response</span>
            <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">process_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">synapse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_error_message</span><span class="p">(</span><span class="n">synapse</span><span class="p">,</span> <span class="n">request_name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_incoming_response</span><span class="p">(</span><span class="n">synapse</span><span class="p">)</span>

            <span class="c1"># Log synapse event history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">synapse_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Synapse</span><span class="o">.</span><span class="n">from_headers</span><span class="p">(</span><span class="n">synapse</span><span class="o">.</span><span class="n">to_headers</span><span class="p">()))</span>

            <span class="c1"># Return the updated synapse object after deserializing if requested</span>
            <span class="k">if</span> <span class="n">deserialize</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">synapse</span><span class="o">.</span><span class="n">deserialize</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">synapse</span></div>


<div class="viewcode-block" id="DendriteMixin.preprocess_synapse_for_request">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.preprocess_synapse_for_request">[docs]</a>
    <span class="k">def</span> <span class="nf">preprocess_synapse_for_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_axon_info</span><span class="p">:</span> <span class="s2">&quot;AxonInfo&quot;</span><span class="p">,</span>
        <span class="n">synapse</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocesses the synapse for making a request. This includes building headers for Dendrite and Axon and signing the request.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_axon_info (bittensor.core.chain_data.axon_info.AxonInfo): The target axon information.</span>
<span class="sd">            synapse (bittensor.core.synapse.Synapse): The synapse object to be preprocessed.</span>
<span class="sd">            timeout (float): The request timeout duration in seconds. Defaults to ``12.0`` seconds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bittensor.core.synapse.Synapse: The preprocessed synapse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set the timeout for the synapse</span>
        <span class="n">synapse</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span> <span class="o">=</span> <span class="n">TerminalInfo</span><span class="p">(</span>
            <span class="n">ip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">external_ip</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">version_as_int</span><span class="p">,</span>
            <span class="n">nonce</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">(),</span>
            <span class="n">uuid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span>
            <span class="n">hotkey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keypair</span><span class="o">.</span><span class="n">ss58_address</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Build the Axon headers using the target axon&#39;s details</span>
        <span class="n">synapse</span><span class="o">.</span><span class="n">axon</span> <span class="o">=</span> <span class="n">TerminalInfo</span><span class="p">(</span>
            <span class="n">ip</span><span class="o">=</span><span class="n">target_axon_info</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">target_axon_info</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
            <span class="n">hotkey</span><span class="o">=</span><span class="n">target_axon_info</span><span class="o">.</span><span class="n">hotkey</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Sign the request using the dendrite, axon info, and the synapse body hash</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">nonce</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">hotkey</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">hotkey</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">uuid</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">synapse</span><span class="o">.</span><span class="n">body_hash</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">keypair</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">synapse</span></div>


<div class="viewcode-block" id="DendriteMixin.process_server_response">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.process_server_response">[docs]</a>
    <span class="k">def</span> <span class="nf">process_server_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">server_response</span><span class="p">:</span> <span class="s2">&quot;aiohttp.ClientResponse&quot;</span><span class="p">,</span>
        <span class="n">json_response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">local_synapse</span><span class="p">:</span> <span class="s2">&quot;Synapse&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes the server response, updates the local synapse state with the server&#39;s state and merges headers set by the server.</span>

<span class="sd">        Args:</span>
<span class="sd">            server_response (object): The `aiohttp &lt;https://github.com/aio-libs/aiohttp&gt;`_ response object from the server.</span>
<span class="sd">            json_response (dict): The parsed JSON response from the server.</span>
<span class="sd">            local_synapse (bittensor.core.synapse.Synapse): The local synapse object to be updated.</span>

<span class="sd">        Raises:</span>
<span class="sd">            None: But errors in attribute setting are silently ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the server responded with a successful status code</span>
        <span class="k">if</span> <span class="n">server_response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># If the response is successful, overwrite local synapse state with</span>
            <span class="c1"># server&#39;s state only if the protocol allows mutation. To prevent overwrites,</span>
            <span class="c1"># the protocol must set Frozen = True</span>
            <span class="n">server_synapse</span> <span class="o">=</span> <span class="n">local_synapse</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">json_response</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">local_synapse</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Set the attribute in the local synapse from the corresponding</span>
                    <span class="c1"># attribute in the server synapse</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">local_synapse</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">server_synapse</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># Ignore errors during attribute setting</span>
                    <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the server responded with an error, update the local synapse state</span>
            <span class="k">if</span> <span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span> <span class="o">=</span> <span class="n">TerminalInfo</span><span class="p">()</span>
            <span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">server_response</span><span class="o">.</span><span class="n">status</span>
            <span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">json_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>

        <span class="c1"># Extract server headers and overwrite None values in local synapse headers</span>
        <span class="n">server_headers</span> <span class="o">=</span> <span class="n">Synapse</span><span class="o">.</span><span class="n">from_headers</span><span class="p">(</span><span class="n">server_response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Merge dendrite headers</span>
        <span class="n">local_synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="o">**</span><span class="n">local_synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
                <span class="o">**</span><span class="n">server_headers</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Merge axon headers</span>
        <span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="o">**</span><span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
                <span class="o">**</span><span class="n">server_headers</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>  <span class="c1"># type: ignore</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Update the status code and status message of the dendrite to match the axon</span>
        <span class="n">local_synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">status_code</span>  <span class="c1"># type: ignore</span>
        <span class="n">local_synapse</span><span class="o">.</span><span class="n">dendrite</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">local_synapse</span><span class="o">.</span><span class="n">axon</span><span class="o">.</span><span class="n">status_message</span>  <span class="c1"># type: ignore</span></div>


<div class="viewcode-block" id="DendriteMixin.__str__">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string representation of the Dendrite object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The string representation of the Dendrite object in the format :func:`dendrite(&lt;user_wallet_address&gt;)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;dendrite(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">keypair</span><span class="o">.</span><span class="n">ss58_address</span><span class="si">}</span><span class="s2">)&quot;</span></div>


<div class="viewcode-block" id="DendriteMixin.__repr__">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.DendriteMixin.__repr__">[docs]</a>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string representation of the Dendrite object, acting as a fallback for :func:`__str__()`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The string representation of the Dendrite object in the format :func:`dendrite(&lt;user_wallet_address&gt;)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span></div>


    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronous context manager entry method.</span>

<span class="sd">        Enables the use of the ``async with`` statement with the Dendrite instance. When entering the context, the current instance of the class is returned, making it accessible within the asynchronous context.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dendrite: The current instance of the Dendrite class.</span>

<span class="sd">        Usage::</span>
<span class="sd">            async with Dendrite() as dendrite:</span>
<span class="sd">                await dendrite.some_async_method()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronous context manager exit method.</span>

<span class="sd">        Ensures proper cleanup when exiting the ``async with`` context. This method will close the `aiohttp &lt;https://github.com/aio-libs/aiohttp&gt;`_ client session asynchronously, releasing any tied resources.</span>

<span class="sd">        Args:</span>
<span class="sd">            exc_type (Type[BaseException]): The type of exception that was raised.</span>
<span class="sd">            exc_value (BaseException): The instance of exception that was raised.</span>
<span class="sd">            traceback (TracebackType): A traceback object encapsulating the call stack at the point where the exception was raised.</span>

<span class="sd">        Usage::</span>
<span class="sd">            import bittensor</span>

<span class="sd">            wallet = bittensor.Wallet()</span>
<span class="sd">            async with bittensor.Dendrite(wallet=wallet) as dendrite:</span>
<span class="sd">                await dendrite.some_async_method()</span>

<span class="sd">        Note:</span>
<span class="sd">            This automatically closes the session by calling :func:`__aexit__` after the context closes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aclose_session</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dendrite destructor.</span>

<span class="sd">        This method is invoked when the Dendrite instance is about to be destroyed. The destructor ensures that the aiohttp client session is closed before the instance is fully destroyed, releasing any remaining resources.</span>

<span class="sd">        Note:</span>
<span class="sd">            Relying on the destructor for cleanup can be unpredictable. It is recommended to explicitly close sessions using the provided methods or the ``async with`` context manager.</span>

<span class="sd">        Usage::</span>

<span class="sd">            dendrite = Dendrite()</span>
<span class="sd">            # ... some operations ...</span>
<span class="sd">            del dendrite  # This will implicitly invoke the __del__ method and close the session.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span></div>



<span class="c1"># For back-compatibility with torch</span>
<span class="n">BaseModel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;torch.nn.Module&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="k">if</span> <span class="n">use_torch</span><span class="p">()</span> <span class="k">else</span> <span class="nb">object</span>


<div class="viewcode-block" id="Dendrite">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.Dendrite">[docs]</a>
<span class="k">class</span> <span class="nc">Dendrite</span><span class="p">(</span><span class="n">DendriteMixin</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>  <span class="c1"># type: ignore</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wallet</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Wallet&quot;</span><span class="p">,</span> <span class="s2">&quot;Keypair&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">use_torch</span><span class="p">():</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">DendriteMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wallet</span><span class="p">)</span></div>



<span class="k">if</span> <span class="ow">not</span> <span class="n">use_torch</span><span class="p">():</span>

<div class="viewcode-block" id="call">
<a class="viewcode-back" href="../../../autoapi/bittensor/core/dendrite/index.html#bittensor.core.dendrite.call">[docs]</a>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


    <span class="n">Dendrite</span><span class="o">.</span><span class="fm">__call__</span> <span class="o">=</span> <span class="n">call</span>
</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Opentensor Foundation
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Opentensor Foundation.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>